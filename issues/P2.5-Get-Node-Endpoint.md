---
**Status:** To Do
**Priority:** P2
**Branch:** `feature/P2.5-Get-Node-Endpoint`
---

## Overview

Implement Get Node by ID Endpoint
**Phase:** 5 - Node Operations

Implement `GET /api/{database}/graph/nodes/{node_id}` endpoint to retrieve a single node by ID.

## User Story

**As an** API consumer
**I want** to retrieve a single node by its ID
**So that** I can view detailed information about a specific node in the graph

## Related Specifications
- [ ] **Spec file:** `specs/endpoints-nodes.md` - Section 1 (Get Node)

## Related BDD Tests
- [ ] **Feature file:** `features/nodes.feature`
- [ ] **Tags:** `@nodes`, `@get`

## Dependencies
- [ ] Issue P2.4 - Node models

---

## TDD Workflow Checklist

### 1️⃣ RED - Write Failing Tests
- [ ] Create: `tests/test_nodes.py`
- [ ] Write tests for GET /api/{database}/graph/nodes/{node_id}
- [ ] **Verify tests FAIL** ❌

### 2️⃣ GREEN - Implement
- [ ] Create: `app/routers/nodes.py`
- [ ] Implement get node endpoint
- [ ] Register router in app/main.py
- [ ] **Verify tests PASS** ✅

### 3️⃣ REFACTOR & BDD
- [ ] Run black, ruff, mypy
- [ ] Run: `behave features/nodes.feature --tags=@get -v`
- [ ] **Verify 100% coverage** ✅

---

## Acceptance Criteria

### Functional Requirements
- [ ] GET /api/{database}/graph/nodes/{node_id} endpoint
- [ ] Returns NodeDetailResponse
- [ ] Returns 404 if node not found
- [ ] Requires authentication

---

## Implementation Notes

```python
"""Node operation endpoints."""

from fastapi import APIRouter, Depends, HTTPException, Path

from app.dependencies import get_neo4j_client, verify_api_key
from app.models import NodeDetailResponse, Node
from app.utils.neo4j_client import Neo4jClient

router = APIRouter(
    prefix="/api/{database}/graph",
    tags=["nodes"],
    dependencies=[Depends(verify_api_key)],
)

@router.get("/nodes/{node_id}", response_model=NodeDetailResponse)
async def get_node(
    database: str = Path(...),
    node_id: str = Path(...),
    client: Neo4jClient = Depends(get_neo4j_client),
) -> NodeDetailResponse:
    """Get node by ID."""

    query = "MATCH (n) WHERE id(n) = $id RETURN n"
    results = client.execute_query(
        query=query,
        parameters={"id": int(node_id)},
        database=database,
    )

    if not results:
        raise HTTPException(status_code=404, detail="Node not found")

    node_data = results[0]["n"]
    node = Node(
        id=str(node_data.id),
        categories=list(node_data.labels),
        properties=dict(node_data),
    )

    return NodeDetailResponse(node=node)
```

---

## Git Workflow

```bash
git checkout main && git pull origin main
git checkout -b feature/P2.5-get-node-endpoint

# TDD, implement, test
pytest tests/test_nodes.py -v
behave features/nodes.feature --tags=@get -v

# Commit
git add app/routers/nodes.py app/main.py tests/test_nodes.py
git commit -m "feat(P2.5): implement get node by ID endpoint"
git push origin feature/P2.5-get-node-endpoint
```

---

## References
- **Specification:** `specs/endpoints-nodes.md` - Section 1
