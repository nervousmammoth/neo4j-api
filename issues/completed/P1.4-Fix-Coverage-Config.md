---
**Status:** To Do
**Priority:** P1
**Branch:** `feature/P1.4-Fix-Coverage-Config`
---

## Overview

Fix Coverage Configuration Gap
**Phase:** Code Quality

The coverage configuration in `pyproject.toml` currently excludes ALL routers (`app/routers/*.py`) from coverage measurement. This means when routers are implemented beyond stubs, they won't require test coverage, defeating the 100% coverage enforcement that is central to this project's quality standards.

## Related Specifications
- N/A - This is a configuration fix

## Dependencies
- None - Can be done independently

---

## TDD Workflow Checklist

### 1ï¸âƒ£ RED - Verify Problem
- [ ] Run coverage with current config: `pytest --cov=app --cov-report=term-missing`
- [ ] Note that `app/routers/health.py` is NOT in the coverage report
- [ ] **Verify the issue exists** âŒ

### 2ï¸âƒ£ GREEN - Fix Configuration
- [ ] Edit `pyproject.toml`
- [ ] Remove `"app/routers/*.py"` from `[tool.coverage.run] omit` list
- [ ] Run coverage: `pytest --cov=app --cov-report=term-missing`
- [ ] **Verify `app/routers/health.py` now appears in coverage** âœ…
- [ ] **Verify 100% coverage maintained** âœ…

### 3ï¸âƒ£ REFACTOR - Verify No Side Effects
- [ ] Run full test suite: `pytest`
- [ ] Run pre-commit: `pre-commit run --all-files`
- [ ] **Verify all checks pass** âœ…

---

## Acceptance Criteria

### Functional Requirements
- [ ] Coverage omit no longer excludes `app/routers/*.py`
- [ ] `app/routers/health.py` appears in coverage report
- [ ] All tests still pass with 100% coverage

### Code Quality Gates
- [ ] Pre-commit hooks pass
- [ ] All pytest tests pass
- [ ] Coverage >= 100%

---

## Implementation Notes

### Files to Modify
```
pyproject.toml
```

### Key Implementation Details
- Line ~73 in `pyproject.toml` contains the omit pattern
- The skeleton routers (search, query, nodes, schema) have no executable code, so removing the exclusion won't affect coverage
- Only `health.py` has actual implementation that will now be included

### Before (problematic)
```toml
[tool.coverage.run]
omit = [
    "tests/*",
    "app/__init__.py",
    "app/routers/*.py",  # <-- REMOVE THIS LINE
    # ... other exclusions
]
```

### After (fixed)
```toml
[tool.coverage.run]
omit = [
    "tests/*",
    "app/__init__.py",
    # app/routers/*.py removed - routers should be covered
    # ... other exclusions
]
```

---

## Git Workflow

### Start Issue
```bash
git checkout main
git pull origin main
git checkout -b feature/P1.4-fix-coverage-config
```

### During Development
```bash
# Make changes
git add pyproject.toml
git commit -m "fix(P1.4): remove router exclusion from coverage config"
git push origin feature/P1.4-fix-coverage-config
```

### Create Pull Request
```bash
gh pr create \
  --title "fix: remove router exclusion from coverage config" \
  --body "$(cat <<'EOF'
## Summary
- Removes blanket `app/routers/*.py` exclusion from coverage config
- Ensures implemented routers (like health.py) are included in coverage

## Changes
- `pyproject.toml`: Remove `"app/routers/*.py"` from omit list

## Testing
- [x] All pytest tests pass
- [x] 100% coverage maintained
- [x] Pre-commit hooks pass

## Closes
Closes #37

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

### After Merge
```bash
mv issues/P1.4-fix-coverage-config.md issues/completed/
git checkout main
git pull origin main
```

---

## Verification Commands

```bash
# Run coverage and verify health.py appears
pytest --cov=app --cov-report=term-missing

# Run all quality checks
pre-commit run --all-files

# Full test suite
./scripts/run_all_tests.sh
```

---

## Notes
This is a CRITICAL fix that should be done before implementing any new routers. Without this fix, new router implementations could have 0% test coverage and still pass the pre-push hook.
